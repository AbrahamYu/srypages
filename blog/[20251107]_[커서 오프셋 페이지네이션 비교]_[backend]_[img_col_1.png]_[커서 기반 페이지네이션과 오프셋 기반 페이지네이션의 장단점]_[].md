
# 오프셋과 커서 방식 정리

수많은 상품 목록이나 게시글을 스크롤하며 원하는 정보를 찾지 못해 답답했던 경험이 있나요? 웹 서비스에서 대량의 데이터를 효과적으로 보여주는 페이지네이션(Pagination)은 사용자 경험에 큰 영향을 미칩니다. 이번 글에서는 가장 널리 쓰이는 두 가지 페이지네이션 방식, **오프셋 기반**과 **커서 기반** 방식의 특징과 장단점을 알기 쉽게 비교하고, 어떤 상황에 어떤 방식을 선택하는 것이 좋을지 알아보겠습니다.

## 1. 오프셋 기반 페이지네이션 (Offset-based, 페이지 번호로 이동하기)

오프셋 기반 페이지네이션은 우리에게 가장 익숙한 '페이지 번호' 방식입니다. 온라인 쇼핑몰의 상품 목록이나 블로그의 게시글 목록 하단에서 흔히 볼 수 있습니다.

> "3페이지로 가기" 버튼을 누르면, 정해진 개수만큼의 데이터를 건너뛰고 그 다음 데이터를 보여주는 원리입니다.

데이터베이스에서는 보통 다음과 같은 형태로 작동합니다.

```sql
-- 2페이지의 게시물 10개를 가져오는 경우 (1페이지당 10개씩 보여준다고 가정)
SELECT * FROM posts
ORDER BY created_at DESC
LIMIT 10 OFFSET 10; -- 10개를 건너뛰고 10개를 가져온다.
```

### 장점
- **자유로운 이동**: 사용자가 원하는 페이지 번호로 한 번에 이동할 수 있어 편리합니다.
- **예측 가능한 구조**: 전체 데이터 양과 현재 위치를 명확하게 파악할 수 있습니다.

### 단점
- **느려지는 뒷페이지**: 데이터가 수백만 개에 달할 경우, 뒤쪽 페이지로 갈수록 건너뛰어야 할 데이터가 많아져 성능이 눈에 띄게 저하될 수 있습니다.
- **데이터 중복 또는 누락**: 사용자가 페이지를 넘기는 순간 새로운 데이터가 추가되면, 페이지 내용이 밀리면서 같은 데이터를 중복해서 보거나 특정 데이터를 놓칠 수 있습니다.

## 2. 커서 기반 페이지네이션 (Cursor-based, 더 보기 버튼)

커서 기반 페이지네이션은 페이스북이나 트위터 같은 소셜 미디어 피드에서 흔히 볼 수 있는 '더 보기' 또는 '무한 스크롤' 방식입니다. 마지막으로 본 데이터의 위치를 '커서(Cursor)'로 기억하고, 그 지점부터 다음 데이터를 불러옵니다.

> 사용자는 스크롤을 내리거나 "더 보기" 버튼을 눌러 새로운 콘텐츠를 계속해서 로드할 수 있습니다.

데이터베이스에서는 주로 이렇게 구현됩니다.

```sql
-- 마지막으로 본 게시물의 ID가 100인 경우
SELECT * FROM posts
WHERE id < 100 -- 마지막으로 본 게시물(커서)보다 오래된 게시물을 찾는다
ORDER BY id DESC
LIMIT 10; -- 10개를 가져온다.
```

### 장점
- **빠르고 일정한 성능**: 데이터가 얼마나 많든, 특정 지점부터 조회를 시작하므로 매우 빠르고 일정한 성능을 유지합니다.
- **데이터 정합성**: 실시간으로 데이터가 변동되어도 기준점(커서)이 명확하므로 데이터 누락이나 중복 문제가 발생하지 않습니다.

### 단점
- **제한적인 이동**: 특정 페이지로 한 번에 건너뛸 수 없고, 오직 '다음' 목록만 순차적으로 볼 수 있습니다.
- **복잡한 구현**: 오프셋 방식에 비해 커서로 사용할 고유하고 순차적인 값(예: ID, 생성 시간)을 관리해야 하므로 구현이 조금 더 복잡할 수 있습니다.

## 어떤 방식을 선택해야 할까?

두 방식의 장단점이 명확하기 때문에, 서비스의 특징에 맞춰 현명하게 선택해야 합니다.

**오프셋 기반 페이지네이션이 적합한 경우** :

> - 전체 데이터의 양이 예측 가능하고, 자주 변동되지 않는 경우 (예: 검색 결과, 쇼핑몰 카테고리별 상품 목록)
> - 사용자가 특정 페이지로 바로 이동해야 하는 기능이 중요한 경우
> - 각 페이지가 고유한 URL(`example.com/posts?page=3`)을 갖게 되어 공유나 북마크에 유리합니다.

**커서 기반 페이지네이션이 적합한 경우** : 

>- 실시간으로 데이터가 계속 추가되고 양이 매우 많은 경우 (예: 소셜 미디어 피드, 실시간 채팅 목록)
>- 사용자가 최신 콘텐츠부터 순차적으로 소비하는 것이 중요한 경우
>- 빠르고 끊김 없는 사용자 경험을 제공하고자 할 때 효과적입니다.

### 마무리하며

페이지네이션은 단순히 데이터를 나누는 기술을 넘어, 사용자가 콘텐츠를 소비하는 방식과 서비스의 성능까지 결정하는 중요한 설계 요소입니다. 우리 서비스의 데이터가 어떻게 생겼고, 사용자는 무엇을 원하는지 고민하여 최적의 방식을 선택한다면, 사용자에게는 쾌적한 경험을, 서비스에는 안정적인 성능을 선물할 수 있을 것입니다.
